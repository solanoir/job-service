<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developer Search</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- Login Form -->
  <div id="loginContainer" class="login-container">
    <div class="login-form">
      <h2>Login</h2>
      <input type="text" id="loginId" placeholder="ID" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <div id="loginError" class="error-message" style="display:none;"></div>
    </div>
  </div>

  <!-- Main App -->
  <div id="mainContainer" class="main-container" style="display:none;">
    <div class="left-panel">
      <h1>Developer Knowledge Search</h1>

      <!-- Collation Select -->
      <div class="select-group">
        <label for="collationSelect">Collation:</label>
        <select id="collationSelect" multiple>
        </select>
      </div>

      <!-- Type Select -->
      <div class="select-group">
        <label for="typeSelect">Type:</label>
        <select id="typeSelect" multiple>
        </select>
      </div>


    </div>

    <div class="right-panel">
      <!-- Search Box -->
      <div class="search-area">
        <input type="text" id="searchInput" placeholder="Type a keyword..." />
        <button id="searchBtn">Search</button>
      </div>
      <!-- Active Filters -->
      <div id="activeFilters" class="active-filters"></div>
      <!-- Search Term Display -->
      <div id="searchTermDisplay" class="search-term-display" style="display:none;"></div>
      <!-- Results -->
      <div id="results" class="results"></div>
      <div id="error" class="error-message" style="display:none;color:#b00020;margin-top:8px;"></div>
    </div>
  </div>

  <script>
    let data = [];

    const collationAvatars = {
      'Full stack': 'ðŸ› ï¸',
      'shopify': 'ðŸ›’',
      'scraping': 'ðŸ•·ï¸',
      'game': 'ðŸŽ®',
      'Python': 'ðŸ',
      'JavaScript (JS)': 'ðŸŸ¨',
      'Node.js': 'âš¡',
      'TypeScript (TS)': 'ðŸ”µ',
      'C++': 'ðŸ’ ',
      'C#': 'ðŸŸ£',
      'Java': 'â˜•',
      'Go (Golang)': 'ðŸ’™',
      'Rust': 'ðŸ¦€',
      'Swift': 'ðŸ',
      'PHP': 'ðŸ’œ',
      'HTML': 'ðŸ“„',
      'CSS': 'ðŸŽ¨',
      'SQL': 'ðŸ—„ï¸',
      'PostgreSQL': 'ðŸ§±',
      'MySQL': 'ðŸ§Š'
    };

    // Login
    document.getElementById('loginBtn').addEventListener('click', () => {
      const id = document.getElementById('loginId').value;
      const password = document.getElementById('loginPassword').value;
      const errorBox = document.getElementById('loginError');
      if (id === 'admin' && password === 'admin') {
        document.getElementById('loginContainer').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'flex';
        fetchData();
      } else {
        errorBox.style.display = 'block';
        errorBox.textContent = 'Invalid ID or password';
      }
    });

    // Load JSON (relative file)
    const errorBox = document.getElementById('error');
    function showError(msg) {
      console.error(msg);
      errorBox.style.display = 'block';
      errorBox.textContent = msg;
    }

    if (location.protocol === 'file:') {
      // When opening an HTML file directly in the browser (file://), fetch will often fail due to CORS/file restrictions.
      showError('Warning: opening via file:// prevents loading JSON. Run a local server (see README) or click "Run a Local Server" below.');
    }

    function fetchData() {
      // Show a temporary "loading" state
      document.getElementById('results').innerHTML = '<p class="loading">Loading...</p>';

      // Embedded data to ensure all values are loaded
      data = [
        { "collation": "Python", "type": "Action-Focused", "content": "Letâ€™s launch your Shopify store in days not weeks." },
        { "collation": "JavaScript (JS)", "type": "Action-Focused", "content": "I build sites that load fast, sell strong, and never crash." },
        { "collation": "Node.js", "type": "Action-Focused", "content": "Need a developer who actually meets deadlines? I live by them." },
        { "collation": "TypeScript (TS)", "type": "Action-Focused", "content": "You handle the ideas Iâ€™ll handle the heavy lifting." },
        { "collation": "C++", "type": "Action-Focused", "content": "Iâ€™ll take your concept and turn it into something youâ€™ll proudly show off." },
        { "collation": "C#", "type": "Action-Focused", "content": "Fast communication, clean code, zero drama thatâ€™s my style." },
        { "collation": "Java", "type": "Action-Focused", "content": "Your next sale could come from a single line of my code letâ€™s make that happen." },
        { "collation": "Go (Golang)", "type": "Trust-Building & Professional", "content": "Youâ€™re not just hiring a developer youâ€™re gaining a business partner who cares." },
        { "collation": "Rust", "type": "Trust-Building & Professional", "content": "My goal is to make your website perform so well you forget what downtime feels like." },
        { "collation": "Swift", "type": "Trust-Building & Professional", "content": "Iâ€™ve built for startups, agencies, and dreamers now letâ€™s build yours." },
        { "collation": "PHP", "type": "Trust-Building & Professional", "content": "I understand business, not just code I build sites that make money." },
        { "collation": "HTML", "type": "Trust-Building & Professional", "content": "If you want a developer who listens first and delivers second, thatâ€™s me." },
        { "collation": "CSS", "type": "Trust-Building & Professional", "content": "Your website is your digital handshake letâ€™s make it a firm one." },
        { "collation": "SQL", "type": "Trust-Building & Professional", "content": "I believe design should be simple, speed should be instant, and clients should smile." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Letâ€™s make your Shopify store your best employee available twenty four seven with no coffee breaks." },
        { "collation": "game", "type": "Bold & Energetic", "content": "I donâ€™t build just another website. I build your online sales engine." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Youâ€™ve got the product Iâ€™ve got the tech to make it sell." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Letâ€™s give your brand the digital glow up it deserves." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Iâ€™ll help you stop chasing customers and start attracting them." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Youâ€™ve done the hard part building your business. Now letâ€™s make the world see it." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Your store should sell while you sleep Iâ€™ll make sure it does." },
        { "collation": "game", "type": "Bold & Energetic", "content": "I donâ€™t believe in average I build sites that stand out and sell out." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Letâ€™s create something so good your competition will wish they hired me first." },
        { "collation": "game", "type": "Bold & Energetic", "content": "I bring energy, design sense, and caffeine everything your project needs." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Letâ€™s skip the buzzwords and build something that makes money." },
        { "collation": "game", "type": "Bold & Energetic", "content": "You need a Shopify store that impresses customers not just looks pretty." },
        { "collation": "game", "type": "Bold & Energetic", "content": "Iâ€™ve seen good stores. I build the ones that outperform them." },
        { "collation": "PostgreSQL", "type": "Emotional & Human", "content": "Every line of my code is written to make your business stronger." },
        { "collation": "MySQL", "type": "Emotional & Human", "content": "I take pride in my work your success is the only result that matters." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "Letâ€™s build something that you will show your friends and say that is mine." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "I love seeing clients win that is why I build like a teammate, not a vendor." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "Youâ€™ve put your heart into your business I will match that energy in the code." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "I donâ€™t overpromise. I overdeliver." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "Every website I build is personal to me because your success is my best marketing." },
        { "collation": "Full stack", "type": "Emotional & Human", "content": "Letâ€™s make your project the one everyone else wishes they built." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "Letâ€™s turn your Shopify store into a twenty four seven sales machine." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "I build Shopify stores that make customers click Add to Cart without thinking twice." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "If your Shopify store is not selling, it is not your product it is your setup." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "I design stores that convert browsers into buyers fast." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "Your next sale could be one UX tweak away letâ€™s find it." },
        { "collation": "shopify", "type": "Shopify Conversion & Sales", "content": "I donâ€™t just build stores I build profit pipelines." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "If your Shopify store loads slower than your morning coffee, we need to fix that." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "A fast store means more sales. I make that happen." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "Iâ€™ve turned slow stores into fast ones and doubled conversions." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "Your store deserves to fly, not crawl. I will fix that." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "Letâ€™s make your Shopify site so fast even Google smiles." },
        { "collation": "shopify", "type": "Shopify Speed & Performance", "content": "I turn laggy Shopify stores into lightning." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "I turn messy ideas into sleek, high performing websites that convert." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "Your business deserves a site that works as hard as you do." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "I have seen what slow sites do to sales and I do not let that happen." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "I do not just code, I connect strategy, speed, and design into one engine." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "Think of me as your full stack problem solver, not just another freelancer." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "Every pixel and every line of code is built like it is my own brand." },
        { "collation": "Full stack", "type": "Clever & Confident", "content": "Your websiteâ€™s first impression can make or break your sale letâ€™s make it memorable." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "I build Shopify stores that sell faster than your morning coffee disappears." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "My code has zero bugs only undocumented features." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "Letâ€™s make your website look so good that your competitors will stalk your source code." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "I treat broken sites like puzzles and I hate leaving pieces missing." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "I code like I cook clean, fast, and always with a little spice." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "If your site loads slower than a Monday morning, I can fix that." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "I am not a magician but I make Shopify stores that magically convert." },
        { "collation": "scraping", "type": "Funny & Playful", "content": "I write JavaScript and bad jokes and both make clients smile." }
      ];

      populateSelects();
      updateActiveFilters();
      // Show initial results (all items) after data loads
      search();
      errorBox.style.display = 'none';
    }

    // Populate selects
    function populateSelects() {
      const collationSelect = document.getElementById('collationSelect');
      const typeSelect = document.getElementById('typeSelect');

      const allCollations = Object.keys(collationAvatars);
      const uniqueTypes = [...new Set(data.map(item => item.type))];

      allCollations.forEach(collation => {
        const option = document.createElement('option');
        option.value = collation;
        option.textContent = (collationAvatars[collation] || 'ðŸ“') + ' ' + collation;
        collationSelect.appendChild(option);
      });

      uniqueTypes.forEach(type => {
        const option = document.createElement('option');
        option.value = type;
        option.textContent = type;
        typeSelect.appendChild(option);
      });
    }

    // Search function - tokenized (one or more words)
    function search() {
      const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
      const selectedCollations = Array.from(document.getElementById("collationSelect").selectedOptions).map(o => o.value);
      const selectedTypes = Array.from(document.getElementById("typeSelect").selectedOptions).map(o => o.value);
      const resultsBox = document.getElementById("results");

      // Add search term display
      const searchTermDisplay = document.getElementById("searchTermDisplay");
      if (keyword) {
        searchTermDisplay.textContent = `Search results for: "${keyword}"`;
        searchTermDisplay.style.display = "block";
      } else {
        searchTermDisplay.style.display = "none";
      }

      resultsBox.innerHTML = "";

      // Split into tokens and require that every token is present in content (AND semantics)
      const tokens = keyword.length ? keyword.split(/\s+/).filter(Boolean) : [];

      const filtered = data.filter(item => {
        const textLower = (item.collation + ' ' + item.type + ' ' + item.content).toLowerCase();
        const matchKeyword = tokens.length === 0 || tokens.every(t => textLower.includes(t));
        const matchCollation = selectedCollations.length === 0 || selectedCollations.includes(item.collation);
        const matchType = selectedTypes.length === 0 || selectedTypes.includes(item.type);

        console.log(item);
        

        return matchKeyword && matchCollation && matchType;
      });

      if (filtered.length === 0) {
        resultsBox.innerHTML = "<p class='no-results'>No matching results found.</p>";
        return;
      }

      filtered.forEach(item => {
        const div = document.createElement("div");
        div.className = "result-item";
        const emoji = collationAvatars[item.collation] || '';
        div.innerHTML = `<strong>Collation:</strong> ${emoji} ${item.collation}<br><strong>Type:</strong> ${item.type}<br><strong>Content:</strong> `;
        div.appendChild(createHighlightNode(item.content, keyword));
        resultsBox.appendChild(div);
      });
    }

    // Button click â†’ search
    document.getElementById("searchBtn").addEventListener("click", search);

    // ENTER key â†’ search
    document.getElementById("searchInput").addEventListener("keydown", function (e) {
      if (e.key === "Enter") search();
    });

    // Live search while typing for immediate feedback
    document.getElementById("searchInput").addEventListener("input", function (e) {
      search();
    });

    // Update active filters display
    function updateActiveFilters() {
      const activeFiltersDiv = document.getElementById("activeFilters");
      activeFiltersDiv.innerHTML = "";

      const selectedCollations = Array.from(document.getElementById("collationSelect").selectedOptions).map(o => o.value);
      const selectedTypes = Array.from(document.getElementById("typeSelect").selectedOptions).map(o => o.value);

      const allSelected = [
        ...selectedCollations.map(c => ({ type: 'collation', value: c })),
        ...selectedTypes.map(t => ({ type: 'type', value: t }))
      ];

      if (allSelected.length === 0) {
        activeFiltersDiv.style.display = "none";
        return;
      }

      activeFiltersDiv.style.display = "block";

      allSelected.forEach(item => {
        const tag = document.createElement("span");
        tag.className = "filter-tag";
        const emoji = item.type === 'collation' ? (collationAvatars[item.value] || '') : '';
        tag.innerHTML = `${emoji} ${item.type}: ${item.value} <button onclick="removeFilter('${item.type}', '${item.value}')">Ã—</button>`;
        activeFiltersDiv.appendChild(tag);
      });
    }

    function removeFilter(filterType, value) {
      const select = document.getElementById(filterType + "Select");
      const option = Array.from(select.options).find(o => o.value === value);
      if (option) {
        option.selected = false;
      }
      updateActiveFilters();
      search();
    }

    // Select change â†’ update filters and search
    document.getElementById("collationSelect").addEventListener("change", () => {
      updateActiveFilters();
      search();
    });
    document.getElementById("typeSelect").addEventListener("change", () => {
      updateActiveFilters();
      search();
    });

    // Utility function to safely escape regex chars in user input
    function escapeRegExp(s) {
      return s.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }

    // Create a DocumentFragment with highlighted matches for the given search (case-insensitive)
    function createHighlightNode(text, search) {
      const frag = document.createDocumentFragment();
      if (!search || !search.trim()) {
        frag.appendChild(document.createTextNode(text));
        return frag;
      }

      const tokens = search.trim().split(/\s+/).filter(Boolean);
      if (tokens.length === 0) {
        frag.appendChild(document.createTextNode(text));
        return frag;
      }

      const pattern = tokens.map(escapeRegExp).join('|');
      const regex = new RegExp(pattern, 'gi');
      let lastIndex = 0;
      let m;
      while ((m = regex.exec(text)) !== null) {
        const start = m.index;
        if (start > lastIndex) {
          frag.appendChild(document.createTextNode(text.slice(lastIndex, start)));
        }
        const span = document.createElement('span');
        span.className = 'highlight';
        span.textContent = text.slice(start, regex.lastIndex);
        frag.appendChild(span);
        lastIndex = regex.lastIndex;
      }
      if (lastIndex < text.length) {
        frag.appendChild(document.createTextNode(text.slice(lastIndex)));
      }
      return frag;
    }

  </script>

</body>

</html>